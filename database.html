<!DOCTYPE html>
<html lang="en"> <!-- The "lang" attribute will be updated by main.js -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focused Database - Volt China</title> <!-- The title will be updated by main.js -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<!-- Step 2a: Added data-page-key to the body tag -->
<body data-page-key="page_title_database"> 
    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo" style="text-decoration: none; color: inherit;">
                    <span data-i18n="site_logo">China EV Intelligence</span>
                </a>
                <!-- Step 2b: Added data-i18n to all translatable elements -->
                <ul class="nav-links">
                    <li><a href="index.html" data-i18n="nav_home">Home</a></li>
                    <li><a href="intelligence.html" data-i18n="nav_intelligence">Intelligence</a></li>
                    <li><a href="database.html" data-i18n="nav_database">Focused Database</a></li>
                    <li><a href="pricing.html" data-i18n="nav_pricing">Pricing</a></li>
                    <li><a href="about.html" data-i18n="nav_about">About</a></li>
                </ul>
                <div class="nav-actions">
                    <!-- The new language toggle button -->
                    <button class="lang-toggle" data-i18n="nav_language">English</button>
                    <button class="login-btn" data-i18n="login_btn">Login</button>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <section class="page-content" style="display: block;">
            <div class="container">
                <h2 class="section-title" data-i18n="db_section_title">Focused EV Model Database</h2>
                <div class="filters">
                    <h3 class="filter-title" data-i18n="db_filter_title">Filter by Brand:</h3>
                    <div class="filter-options">
                        <button class="filter-option active" data-brand="All" data-i18n="db_filter_all">All</button>
                        <button class="filter-option" data-brand="Xiaomi">Xiaomi</button>
                        <button class="filter-option" data-brand="NIO">NIO</button>
                        <button class="filter-option" data-brand="BYD">BYD</button>
                    </div>
                </div>
                <div class="models-grid" id="models-grid-container"></div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <ul class="footer-links">
                <li><a href="about.html" data-i18n="footer_about">About Us</a></li>
                <li><a href="contact.html" data-i18n="footer_contact">Contact</a></li>
                <li><a href="#" data-i18n="footer_privacy">Privacy Policy</a></li>
                <li><a href="#" data-i18n="footer_terms">Terms of Service</a></li>
            </ul>
            <p class="copyright" data-i18n="footer_copyright">Â© 2025 China EV Intelligence. All rights reserved.</p>
        </div>
    </footer>

    <!-- Step 2c: Include the two new JavaScript files at the end of the body -->
    <script src="js/translations.js"></script>
    <script src="js/main.js"></script>

    <!-- Page-specific script for dynamic content -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const gridContainer = document.getElementById('models-grid-container');
        const filterOptions = document.querySelectorAll('.filter-option');
        
        let allModelsData = [];
        let currentTranslations = {};

        function renderModels(models, trans) {
            gridContainer.innerHTML = '';
            if (models.length === 0) {
                gridContainer.innerHTML = `<p style="color: var(--text-secondary);">${trans.error_no_models}</p>`;
                return;
            }
            models.forEach(model => {
                const card = `
                    <div class="model-card">
                        <div class="model-image" style="background-image: url('${model.image_card}');"></div>
                        <div class="model-content">
                            <h3 class="model-title">${model.model_name}</h3>
                            <div class="model-brand">${model.brand}</div>
                            <div class="model-status">${model.status}</div>
                            <div class="model-specs">
                                <div class="spec-item"><span class="spec-label">${trans.card_range}</span><span class="spec-value">${model.key_specs.range_cltc}</span></div>
                                <div class="spec-item"><span class="spec-label">${trans.card_acceleration}</span><span class="spec-value">${model.key_specs.zero_to_100}</span></div>
                                <div class="spec-item"><span class="spec-label">${trans.card_power}</span><span class="spec-value">${model.key_specs.power_kw}</span></div>
                            </div>
                            <a href="model-detail.html?id=${model.id}" class="view-details">${trans.card_details_btn}</a>
                        </div>
                    </div>
                `;
                gridContainer.innerHTML += card;
            });
        }

        fetch('data/models.json')
            .then(response => response.json())
            .then(data => { allModelsData = data; })
            .catch(error => { console.error('Error loading model data:', error); });

        // Listen for the custom event from main.js to get translations
        document.addEventListener('languageUpdated', (event) => {
            currentTranslations = event.detail.translations;
            const activeFilter = document.querySelector('.filter-option.active').getAttribute('data-brand');
            const modelsToRender = activeFilter === 'All' ? allModelsData : allModelsData.filter(m => m.brand === activeFilter);
            renderModels(modelsToRender, currentTranslations);
        });

        filterOptions.forEach(button => {
            button.addEventListener('click', () => {
                filterOptions.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                const selectedBrand = button.getAttribute('data-brand');
                const filteredModels = (selectedBrand === 'All') ? allModelsData : allModelsData.filter(m => m.brand === selectedBrand);
                renderModels(filteredModels, currentTranslations);
            });
        });
    });
    </script>
</body>
</html>